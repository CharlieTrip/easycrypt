# -*- Makefile -*-

# --------------------------------------------------------------------
.PHONY: default linux linux-on-macos macos
.PHONY: docker-appimage appimage-base appimage-on-macos clean

# --------------------------------------------------------------------
default:
	@echo "make [linux|macos]"

linux:
	scripts/build-linux.sh

linux-on-macos:
	docker run -t -i -v "$$PWD:/home/ci/package" easycryptpa/ec-build-box \
	  sh -c '( set -ex; cp -a package package.dev && make -C package.dev linux && cp -a package.dev/_build package )'

macos:
	scripts/build-macos.sh

appimage-base:
	rm -rf _build/appimage && scripts/build-appimage.sh

docker-appimage:
	cd config/appimage-docker && docker build -t easycryptpa/ec-appimage .

appimage-on-macos: appimage-base
	docker run -t -i -v "$$PWD:/home/ci/package" easycryptpa/ec-appimage \
	  sh -c '( set -ex; ./appimagetool package/_build/appimage/EasyCrypt package/_build/EasyCrypt.AppImage )'

clean:
	rm -rf _build
